import{b as W,d as J,e as G,g as q,i as H,j as K,p as Q,q as X,u as F,v as N,w as oe}from"./chunk-5OU5PUPV.js";import{j,k as U,o as T,p as V}from"./chunk-OWBCPQNA.js";import{Bb as R,Cb as z,Db as B,Fb as C,Hb as A,Ib as $,Kb as w,Mb as y,Sa as l,Ta as v,e as ie,fa as _,fb as p,hb as c,jb as o,jc as S,kb as a,kc as I,lb as f,lc as k,nc as E,oa as M,ob as O,oc as D,pa as b,pb as m,qb as g,wb as d,xb as x,yb as P,zb as L}from"./chunk-RNXY7ZYS.js";var Z=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=_({type:i,selectors:[["app-messagemain"]],standalone:!0,features:[C],decls:1,vars:0,template:function(t,s){t&1&&f(0,"router-outlet")},dependencies:[T,j]});let n=i;return n})();var h=ie(oe());var de=n=>({show:n});function ce(n,i){if(n&1){let r=O();o(0,"div",22),m("click",function(){M(r);let t=g();return b(t.onAddMessage())}),f(1,"i",23),a()}}function pe(n,i){n&1&&(o(0,"div",24),f(1,"div",25),a())}function me(n,i){if(n&1&&(o(0,"span",29),d(1),a()),n&2){let r=g().$implicit;l(),x(r.unread_count)}}function ge(n,i){if(n&1){let r=O();o(0,"tr",27),m("click",function(){let t=M(r).$implicit,s=g(2);return b(s.viewConvoMessage(t))}),o(1,"td"),d(2),p(3,me,2,1,"span",28),a(),o(4,"td"),d(5),a(),o(6,"td"),d(7),w(8,"date"),a()()}if(n&2){let r=i.$implicit;l(2),P(" ",r.lastname+", "+r.firstname," "),l(),c("ngIf",r.unread_count>0),l(2),x(r.messages),l(2),x(y(8,4,r.created_at,"MMMM d, y, h:mm a"))}}function fe(n,i){if(n&1&&(o(0,"tbody"),p(1,ge,9,7,"tr",26),a()),n&2){let r=g();l(),c("ngForOf",r.messages)}}function ue(n,i){if(n&1&&(o(0,"option",30),d(1),a()),n&2){let r=i.$implicit;c("value",r.lrn),l(),L(" ",r.firstname," ",r.lastname," ")}}var ee=(()=>{let i=class i{viewConvoMessage(e){let t=`${e.firstname} ${e.lastname}`;localStorage.setItem("lrn",e.lrn),localStorage.setItem("learner",t),this.route.navigate(["/main/Message/main/message/view"])}sendReply(e){if(this.isSubmitting=!0,this.replyText.trim()){let t={lrn:e,messages:this.replyText,adminID:localStorage.getItem("id"),mid:this.selectedMessageID};this.apiserve.sendReply(t).subscribe(s=>{console.log("Reply sent successfully:",s),h.default.fire({position:"top-end",icon:"success",title:"Reply sent successfully!",showConfirmButton:!1,timer:1e3}),this.isModalOpen3=!1,this.replyText="",this.loadMessage(localStorage.getItem("id")),this.isSubmitting=!1},s=>{console.error("Error sending reply:",s),h.default.fire({title:"Error",text:"Failed to send Reply",icon:"error"}),this.isSubmitting=!1})}else h.default.fire({title:"Error",text:"Reply cannot be empty",icon:"error"})}constructor(e,t){this.apiserve=e,this.route=t,this.isLoading=!1,this.isSubmitting=!1,this.isModalOpen=!1,this.isModalOpen2=!1,this.isModalOpen3=!1,this.currentDate=new Date,this.selectedRecipient="",this.selectedMessage=null,this.replyText="",this.currentDate=new Date}ngOnInit(){let e=localStorage.getItem("id");this.student(e),this.admin=this.getAdminDetails(),this.spinner(),this.intervalId=setInterval(()=>{this.loadMessage(e)},2e4)}getAdminDetails(){let e=localStorage.getItem("adminDetails");return e?JSON.parse(e):null}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}spinner(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},2e4)}loadMessage(e){this.apiserve.getMessages(e).subscribe(t=>{this.messages=t,console.log(this.messages)})}student(e){this.apiserve.student(e).subscribe(t=>{this.students=t,console.log(this.students)})}onAddMessage(){this.isModalOpen2=!0}closeModal2(){this.isModalOpen2=!1}closeModal3(){this.isModalOpen3=!1}sendMessage(){let e=document.getElementById("recipient").value,t=document.getElementById("message").value;if(!e){h.default.fire({position:"top-end",icon:"error",title:"Please select a recipient.",showConfirmButton:!1,timer:1500});return}if(!t.trim()){h.default.fire({position:"top-end",icon:"error",title:"Message cannot be empty.",showConfirmButton:!1,timer:1500});return}let s={lrn:e,messages:t,adminID:localStorage.getItem("id")};this.isSubmitting=!0,this.apiserve.sendMessage(s).subscribe(u=>{console.log("Message sent successfully:",u),h.default.fire({position:"top-end",icon:"success",title:"Message sent successfully!",showConfirmButton:!1,timer:1e3}),this.closeModal2(),this.loadMessage(localStorage.getItem("id")),this.isSubmitting=!1},u=>{console.error("Error sending message:",u),h.default.fire({title:"Error",text:"Failed to send Message",icon:"error"}),this.isSubmitting=!1})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}};i.\u0275fac=function(t){return new(t||i)(v(V),v(U))},i.\u0275cmp=_({type:i,selectors:[["app-message"]],standalone:!0,features:[C],decls:44,vars:12,consts:[[1,"wrapper"],[1,"header"],[1,"title-and-date"],[1,"current-date"],[1,"cards-container"],["class","add-icon",3,"click",4,"ngIf"],[1,"message-table"],["class","loader-container",4,"ngIf"],[4,"ngIf"],[1,"modal",3,"click","ngClass"],[1,"modal-content2",3,"click"],[1,"close",3,"click"],[1,"form-group"],["for","recipient"],["id","recipient","name","recipient",1,"form-control"],["value","","active",""],[3,"value",4,"ngFor","ngForOf"],["for","message"],["id","message","name","message","rows","10","placeholder","Compose your message here",1,"form-control"],[1,"form-actions"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"add-icon",3,"click"],["aria-hidden","true",1,"fa","fa-plus-circle","fa-2x"],[1,"loader-container"],[1,"spinner"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["class","badge badge-primary",4,"ngIf"],[1,"badge","badge-primary"],[3,"value"]],template:function(t,s){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),d(4,"Message"),a(),o(5,"p",3),d(6),w(7,"date"),a()()(),o(8,"div",4),p(9,ce,2,0,"div",5),o(10,"table",6)(11,"thead")(12,"tr")(13,"th"),d(14,"Name"),a(),o(15,"th"),d(16,"Message"),a(),o(17,"th"),d(18,"Date"),a()()(),p(19,pe,2,0,"div",7)(20,fe,2,1,"tbody",8),a()()(),o(21,"div",9),m("click",function(){return s.closeModal2()}),o(22,"div",10),m("click",function(ne){return ne.stopPropagation()}),o(23,"span",11),m("click",function(){return s.closeModal2()}),d(24,"\xD7"),a(),o(25,"h2"),d(26,"Compose Message"),a(),o(27,"form")(28,"div",12)(29,"label",13),d(30,"To:"),a(),o(31,"select",14)(32,"option",15),d(33,"Select Student"),a(),p(34,ue,2,3,"option",16),a()(),o(35,"div",12)(36,"label",17),d(37,"Message:"),a(),f(38,"textarea",18),a(),o(39,"div",19)(40,"button",20),m("click",function(){return s.sendMessage()}),d(41,"Send"),a(),o(42,"button",21),m("click",function(){return s.closeModal2()}),d(43,"Cancel"),a()()()()()),t&2&&(l(6),x(y(7,7,s.currentDate,"MMMM d, y | h:mm a")),l(3),c("ngIf",!s.isLoading),l(10),c("ngIf",s.isLoading),l(),c("ngIf",!s.isLoading),l(),c("ngClass",A(10,de,s.isModalOpen2)),l(13),c("ngForOf",s.students),l(6),c("disabled",s.isSubmitting))},dependencies:[D,S,I,k,E,T,N,K,Q,X,G,F,q],styles:[".wrapper[_ngcontent-%COMP%]{margin:0 auto;padding-left:40px;max-width:1300px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.title-and-date[_ngcontent-%COMP%]{display:flex;flex-direction:column}.current-date[_ngcontent-%COMP%]{margin-top:5px;font-size:24px;color:#666}.cards-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-around;gap:20px;margin-top:20px}.add-icon[_ngcontent-%COMP%]{position:absolute;top:200px;right:30px;cursor:pointer;color:#0f3041}.add-icon[_ngcontent-%COMP%]:hover{color:#a81f27}.message-table[_ngcontent-%COMP%]{width:100%;margin-top:40px}.message-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .message-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:12px;text-align:left}.message-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#0f3041;color:#fff}.message-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.message-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#ddd}.message-view[_ngcontent-%COMP%]{margin-top:20px;padding:20px;background-color:#f9f9f9;border-radius:8px;box-shadow:0 2px 5px #0000001a}.reply-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#d6d6d6;color:#a1a1a1;cursor:not-allowed}.notification-icon[_ngcontent-%COMP%]{cursor:pointer}.spinner[_ngcontent-%COMP%]{border:8px solid #f3f3f3;border-top:8px solid #3498db;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin .5s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.badge[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:3px 8px;border-radius:10px;font-size:12px;margin-left:5px}.modal[_ngcontent-%COMP%]{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:#0006;transition:display .5s ease}.modal.show[_ngcontent-%COMP%]{display:block}.modal-content[_ngcontent-%COMP%]{background-color:#fefefe;margin:15% auto;padding:20px;border:1px solid #888;width:80%;max-width:500px}.modal-content2[_ngcontent-%COMP%]{background-color:#fefefe;margin:5% auto;padding:20px;border:1px solid #888;width:80%;max-width:500px}.modal-content3[_ngcontent-%COMP%]{background-color:#fefefe;margin:10% auto;padding:20px;border:1px solid #888;width:80%;max-width:500px;border-radius:8px;box-shadow:0 2px 5px #0000001a}.reply-box[_ngcontent-%COMP%]{margin-top:15px;display:flex;flex-direction:column}.reply-box[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;height:100px;padding:10px;border-radius:4px;border:1px solid #ccc;margin-bottom:10px}.reply-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{align-self:flex-end;padding:10px 20px;background-color:#0f3041;color:#fff;border:none;border-radius:4px;cursor:pointer}.reply-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0f3041}.close[_ngcontent-%COMP%]{color:#aaa;float:right;font-size:28px;font-weight:700;cursor:pointer}.close[_ngcontent-%COMP%]:hover, .close[_ngcontent-%COMP%]:focus{color:#000;text-decoration:none;cursor:pointer}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:700}.form-control[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:16px;border-radius:4px;border:1px solid #ccc;box-sizing:border-box}.form-control[_ngcontent-%COMP%]:focus{border-color:#0f3041;outline:none}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}.btn[_ngcontent-%COMP%]{padding:10px 20px;font-size:16px;border:none;border-radius:4px;cursor:pointer}.btn-primary[_ngcontent-%COMP%]{background-color:#0f3041;color:#fff}.btn-secondary[_ngcontent-%COMP%]{background-color:#f2f2f2;color:#333}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#e6e6e6}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#a81f27}.btn-primary[_ngcontent-%COMP%]:disabled{background-color:#d6d6d6;color:#a1a1a1;cursor:not-allowed}@media (max-width: 768px){.wrapper[_ngcontent-%COMP%]{padding-left:20px;padding-right:20px}.card[_ngcontent-%COMP%]{width:calc(50% - 20px)}}@media (max-width: 576px){.wrapper[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}.card[_ngcontent-%COMP%]{width:100%}}@media (max-width: 480px){.card[_ngcontent-%COMP%]{width:100%}}"]});let n=i;return n})();var xe=(n,i)=>({"admin-message":n,"learner-message":i});function he(n,i){n&1&&(o(0,"div",7),f(1,"div",8),a())}function _e(n,i){if(n&1&&(o(0,"div",9)(1,"div",10)(2,"p",11),d(3),a(),o(4,"p",12),d(5),w(6,"date"),a()()()),n&2){let r=i.$implicit,e=g();l(),c("ngClass",$(6,xe,r.sender_name===e.currentUser,r.sender_name!==e.currentUser)),l(2),x(r.messages),l(2),x(y(6,3,r.created_at,"MMMM d, y | h:mm a"))}}function Me(n,i){if(n&1){let r=O();o(0,"div",13)(1,"textarea",14),B("ngModelChange",function(t){M(r);let s=g();return z(s.newMessage,t)||(s.newMessage=t),b(t)}),a(),o(2,"button",15),m("click",function(){M(r);let t=g();return b(t.sendMessage())}),f(3,"i",16),a()()}if(n&2){let r=g();l(),R("ngModel",r.newMessage),l(),c("disabled",r.isSubmitting)}}var te=(()=>{let i=class i{constructor(e){this.apiService=e,this.isLoading=!1,this.isSubmitting=!1,this.convoMessages=[],this.learnerName="",this.newMessage="",this.currentDate=new Date,this.currentDate=new Date}ngOnInit(){this.NameLearner=localStorage.getItem("learner"),this.lrnLearner=localStorage.getItem("lrn"),this.adminID=localStorage.getItem("id");let e=this.getAdminDetails();this.currentUser=`${e.firstname} ${e.lastname}`,this.spinner(),this.intervalId=setInterval(()=>{this.loadConversation(this.lrnLearner)},2e4)}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}getAdminDetails(){let e=localStorage.getItem("adminDetails");return e?JSON.parse(e):null}loadConversation(e){this.apiService.getConvoMessages(e).subscribe(t=>{this.convoMessages=t,console.log(t),t.length>0&&(this.learnerName=`${t[0].firstname} ${t[0].lastname}`)})}sendMessage(){if(!this.newMessage.trim())return;let e={lrn:this.lrnLearner,adminID:this.adminID,messages:this.newMessage,sender_name:this.learnerName};this.isSubmitting=!0,this.apiService.sendMessage(e).subscribe(t=>{this.loadConversation(this.lrnLearner),this.newMessage="",this.isSubmitting=!1})}spinner(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},2e4)}};i.\u0275fac=function(t){return new(t||i)(v(V))},i.\u0275cmp=_({type:i,selectors:[["app-viewmessage"]],standalone:!0,features:[C],decls:9,vars:4,consts:[[1,"wrapper"],[1,"header"],[1,"title-and-date"],["class","loader-container",4,"ngIf"],[1,"conversation-container"],["class","message",4,"ngFor","ngForOf"],["class","reply-container",4,"ngIf"],[1,"loader-container"],[1,"spinner"],[1,"message"],[3,"ngClass"],[1,"message-text"],[1,"timestamp"],[1,"reply-container"],["placeholder","Type your message here...",3,"ngModelChange","ngModel"],[1,"submitting",3,"click","disabled"],["aria-hidden","true",1,"fa","fa-paper-plane-o","fa-2x"]],template:function(t,s){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),d(4),a()()(),p(5,he,2,0,"div",3),o(6,"div",4),p(7,_e,7,9,"div",5),a(),p(8,Me,4,2,"div",6),a()),t&2&&(l(4),P("Name: ",s.NameLearner,""),l(),c("ngIf",s.isLoading),l(2),c("ngForOf",s.convoMessages),l(),c("ngIf",!s.isLoading))},dependencies:[D,S,I,k,E,N,W,J,F,H],styles:[".wrapper[_ngcontent-%COMP%]{margin:0 auto;padding-left:40px;max-width:1300px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.title-and-date[_ngcontent-%COMP%]{display:flex;flex-direction:column}.current-date[_ngcontent-%COMP%]{margin-top:5px;font-size:24px;color:#666}.conversation-container[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto;margin-bottom:20px}.message[_ngcontent-%COMP%]{margin:10px 0}.admin-message[_ngcontent-%COMP%]{margin-left:auto;text-align:right;background-color:#f0f0f0;color:#000;padding:10px;border-radius:10px 0 10px 10px;max-width:40%;word-wrap:break-word}.learner-message[_ngcontent-%COMP%]{margin-right:auto;text-align:left;background-color:#f0f0f0;color:#000;padding:10px;border-radius:0 10px 10px;max-width:40%;word-wrap:break-word}.message-text[_ngcontent-%COMP%]{margin:0}.timestamp[_ngcontent-%COMP%]{font-size:.8rem;margin-top:5px;color:#888}.reply-container[_ngcontent-%COMP%]{display:flex;gap:10px}textarea[_ngcontent-%COMP%]{flex-grow:1;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:1rem}button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#007bff;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:1rem}.spinner[_ngcontent-%COMP%]{border:8px solid #f3f3f3;border-top:8px solid #3498db;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin .5s linear infinite}.submitting[_ngcontent-%COMP%]:disabled{background-color:#d6d6d6;color:#a1a1a1;cursor:not-allowed}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.wrapper[_ngcontent-%COMP%]{padding-left:20px;padding-right:20px}.card[_ngcontent-%COMP%]{width:calc(50% - 20px)}}@media (max-width: 576px){.wrapper[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}.card[_ngcontent-%COMP%]{width:100%}}@media (max-width: 480px){.card[_ngcontent-%COMP%]{width:100%}}"]});let n=i;return n})();var Te=[{path:"main",component:Z,children:[{path:"message",component:ee},{path:"message/view",component:te},{path:"",redirectTo:"message",pathMatch:"full"}]},{path:"",redirectTo:"main",pathMatch:"full"}];export{Te as a};
